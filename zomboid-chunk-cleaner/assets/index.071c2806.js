import{r as m,j as e,P as U,a as y,F as $,B as T,b as F,C as H,c as W,I as q,S as G,M as Y,d as J,e as Q,f as V,T as O,g as ee,R as te,h as oe,i as ne,k as re}from"./vendor.99d9724b.js";const se=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))u(t);new MutationObserver(t=>{for(const c of t)if(c.type==="childList")for(const o of c.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&u(o)}).observe(document,{childList:!0,subtree:!0});function s(t){const c={};return t.integrity&&(c.integrity=t.integrity),t.referrerpolicy&&(c.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?c.credentials="include":t.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function u(t){if(t.ep)return;t.ep=!0;const c=s(t);fetch(t.href,c)}};se();const A=100,I=()=>{throw new Error("Invalid invocation outside of AppContext!")},K=m.exports.createContext({actions:{deleteMapData:I,loadMapData:I,selectRegion:I,unselectRegion:I,setZoomLevel:I,toggleMap:I},state:{isMapDisplayed:!0,isSelectionInverted:!1,mapData:[],selection:void 0,zoomLevel:1}}),B=()=>m.exports.useContext(K),ae=(l,r)=>{const[s,u]=r;return s.x<=l.x&&l.x<u.x&&s.y<=l.y&&l.y<u.y},N=(l,r,s)=>{let u=ae(l,r);return s&&(u=!u),u},le=(l,r)=>{const s=[[],[]];return l.forEach(u=>{s[r(u)?0:1].push(u)}),s},ie=(l,r,s,u)=>{const[t,c]=le(r,p=>N(p,s,u)),o=t.map(({x:p,y:b})=>`map_${p}_${b}.bin`),v=Promise.all(o.map(p=>l.removeEntry(p))).then(()=>{});return[c,v]},j=(l,r)=>l.parentElement===r?!0:l.parentElement?j(l.parentElement,r):!1,ce=async l=>{const r=[],s=new RegExp(/map_(\d+)_(\d+).bin/);for await(const u of l.keys()){const t=s.exec(u);if(t){const[c,o,v]=t;r.push({x:parseInt(o),y:parseInt(v)})}}return r},de=()=>{const{actions:{selectRegion:l,unselectRegion:r},state:{isMapDisplayed:s,isSelectionInverted:u,mapData:t,selection:c,zoomLevel:o}}=B(),v=m.exports.useRef(null),p=m.exports.useRef(null),b=m.exports.useRef(null),f=m.exports.useMemo(()=>{let i=0,a=0,d=2e4,n=2e4;for(const{x,y:M}of t)i=Math.max(x,i),a=Math.max(M,a),d=Math.min(x,d),n=Math.min(M,n);i+=A,a+=A,d-=A,n-=A;const g=[];for(let x=Math.floor(n/100);x<=Math.floor(a/100);x++)for(let M=Math.floor(d/100);M<=Math.floor(i/100);M++)g.push(`${M}_${x}`);const w=Math.floor(i/100)-Math.floor(d/100)+1;return{maxX:i,maxY:a,minX:d,minY:n,tiles:g,columnCount:w}},[t]);return m.exports.useEffect(()=>{const i=p.current,a=b.current;if(!i||!a)return;const d=i.getContext("2d");if(!d)return;const{maxX:n,maxY:g,minX:w,minY:x}=f,M=Math.max(1,(n-w)*o),C=Math.max(1,(g-x)*o);a.width=i.width=M,a.height=i.height=C,d.fillStyle="hsla(0, 0%, 10%, 0)",d.fillRect(0,0,M,C);for(const S of t){const X=c&&N(S,c,u);d.fillStyle=X?"hsla(0, 100%, 76%, 70%)":"hsla(41, 49%, 76%, 70%)",d.fillRect((S.x-w)*o,(S.y-x)*o,1*o,1*o)}},[t,f,c,u,o]),m.exports.useEffect(()=>{const i=b.current;if(!i)return;const a=i.getContext("2d");if(!a)return;let d={x:0,y:0},n,g;const{minX:w,minY:x}=f,M=h=>{const D=i.getBoundingClientRect(),L=h.clientX-Math.floor(D.left),R=h.clientY-Math.floor(D.top);return{x:Math.floor(L/o+w),y:Math.floor(R/o+x)}},C=()=>{const h=d.x,D=d.y;if(a.clearRect(0,0,i.width,i.height),n){const R=n.x,k=n.y,E=(R-w)*o,P=(k-x)*o,_=(h-R)*o,z=(D-k)*o;a.fillStyle="#f664",g?(a.fillRect(0,0,i.width,i.height),a.clearRect(E,P,_,z)):a.fillRect(E,P,_,z),a.strokeStyle="#f66c",a.strokeRect(E,P,_,z)}a.fillStyle="rgba(0,0,0,0.3)";const{width:L}=a.measureText(`X: ${h} Y: ${D}`);a.fillRect(0,0,L+12,18),a.fillStyle="white",a.fillText(`X: ${h} Y: ${D}`,4,12)},S=h=>{d=M(h),C()},X=h=>{h.button===0&&(!(h.target instanceof HTMLElement)||!v.current||!j(h.target,v.current)||(h.preventDefault(),n=M(h),g=h.ctrlKey,r(),C()))},Z=h=>{if(h.button!==0||(h.preventDefault(),!n))return;const D=d.x,L=d.y,R=n.x,k=n.y,E={x:Math.min(D,R),y:Math.min(L,k)},P={x:Math.max(D,R),y:Math.max(L,k)};n=void 0,C(),l([E,P],g)};return document.body.addEventListener("mousemove",S),document.body.addEventListener("mousedown",X),document.body.addEventListener("mouseup",Z),C(),()=>{document.body.removeEventListener("mousemove",S),document.body.removeEventListener("mousedown",X),document.body.removeEventListener("mouseup",Z)}},[f,l,r,o]),t.length?e(U,{style:{padding:"1rem",userSelect:"none"},children:y("div",{ref:v,style:{display:t.length>0?"grid":"none",contain:"paint",overflow:"auto",maxHeight:"80vh",maxWidth:"80vw"},children:[s&&e("div",{style:{width:o*(f.maxX-f.minX),height:o*(f.maxY-f.minY),overflow:"hidden",gridArea:"1 / 1",backgroundColor:"rgba(0,0,0,0.2)"},children:e("div",{style:{marginLeft:o*-(f.minX%100),marginTop:o*-(f.minY%100),display:"grid",gridTemplateColumns:`repeat(${f.columnCount}, ${o*100}px)`,zIndex:0},children:f.tiles.map(i=>e("img",{className:"tile",src:`./assets/map_${i}.png`,onLoad:a=>{a.currentTarget.classList.add("loaded")},width:o*100,height:o*100},i))})}),e("canvas",{ref:p,style:{zIndex:1,gridArea:"1 / 1",backgroundColor:s?void 0:"hsla(41, 30%, 61%, 1)"}}),e("canvas",{ref:b,style:{zIndex:2,gridArea:"1 / 1"}})]})}):null},ue=l=>{const{onDelete:r}=l,{actions:{loadMapData:s,setZoomLevel:u,toggleMap:t},state:{isMapDisplayed:c,isSelectionInverted:o,mapData:v,selection:p,zoomLevel:b}}=B(),[f,i]=m.exports.useState(!1),a=m.exports.useMemo(()=>p?v.filter(d=>N(d,p,o)).length:0,[v,p,o]);return y($,{children:[y("div",{style:{display:"flex",gap:16,width:1200},children:[e(T,{variant:"contained",onClick:()=>s(),children:"Load map data"}),y(T,{variant:"contained",color:"error",disabled:a===0,onClick:()=>r==null?void 0:r(),children:["Delete ",a," chunks"]}),e("div",{className:"spacer"}),e(F,{control:e(H,{checked:c,onChange:(d,n)=>t(n)}),label:"Overlay Knox Country"}),e(F,{control:e(H,{checked:f,onChange:(d,n)=>i(n)}),label:"Show info"}),y(W,{children:[e(q,{id:"zoom-level-label",children:"Zoom level"}),y(G,{labelId:"zoom-level-label",id:"zoom-level",value:b,label:"Zoom level",onChange:d=>{const{value:n}=d.target;typeof n=="number"&&u(n)},children:[e(Y,{value:.5,children:"50%"}),e(Y,{value:1,children:"100%"}),e(Y,{value:2,children:"200%"}),e(Y,{value:4,children:"400%"}),e(Y,{value:8,children:"800%"})]})]})]}),e(J,{in:f,children:y("ul",{children:[y("li",{children:["Load your save folder, usually: ",e("code",{children:"C:\\Users\\YourName\\Zomboid\\Saves\\Survivor\\21-01-2022_12-36-36"})]}),e("li",{children:"Drag with the mouse to create a selection"}),y("li",{children:["Hold ",e("code",{children:"Ctrl"})," before selecting a region to invert it"]})]})})]})},pe=()=>y($,{children:[e("div",{className:"spacer"}),e("div",{className:"coffee",children:e(T,{style:{backgroundColor:"transparent",padding:0,borderRadius:8},href:"https://www.buymeacoffee.com/grabofus",children:e("img",{alt:"Buy me a coffee",width:"200",src:"./assets/coffee.png"})})})]}),me=l=>{const{isModalOpen:r=!1,onClose:s}=l,{actions:{deleteMapData:u},state:{isSelectionInverted:t,mapData:c,selection:o}}=B(),v=m.exports.useMemo(()=>o?c.filter(p=>N(p,o,t)).length:0,[c,o,t]);return e(Q,{open:r,onClose:()=>s==null?void 0:s(),onMouseDownCapture:p=>{p.nativeEvent.stopImmediatePropagation(),p.nativeEvent.stopPropagation()},onMouseUpCapture:p=>{p.nativeEvent.stopImmediatePropagation(),p.nativeEvent.stopPropagation()},children:y(V,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4},children:[e(O,{variant:"h6",component:"h2",children:"Delete?"}),y(O,{sx:{mt:2},children:["Are you sure you would like to delete ",v," chunk",v>1?"s":"","?"]}),e(O,{sx:{mt:2},children:"This action is not reversible! Make sure you back up your save folder before proceeding!"}),e(T,{color:"error",variant:"contained",sx:{mt:2},onClick:()=>{if(!v){s==null||s(),console.error("");return}u(),s==null||s()},children:"Delete forever!"}),e(T,{style:{marginLeft:16},sx:{mt:2},onClick:()=>{s==null||s()},children:"Cancel"})]})})},fe=()=>{const[l,r]=m.exports.useState(!1);return y($,{children:[e("div",{style:{display:"grid",gap:16},children:e(ue,{onDelete:()=>r(!0)})}),e("div",{children:e(de,{})}),e(pe,{}),e(me,{isModalOpen:l,onClose:()=>r(!1)})]})},he=l=>{const r=m.exports.useRef(),[s,u]=m.exports.useState(!0),[t,c]=m.exports.useState(void 0),[o,v]=m.exports.useState([]),[p,b]=m.exports.useState(1),f=m.exports.useRef();f.current={mapData:o,selectionInfo:t};const i=m.exports.useMemo(()=>({deleteMapData:()=>{if(!f.current)throw new Error("Something went wrong!");const{mapData:n,selectionInfo:g}=f.current;if(!r.current)return console.error("No directory handle found! Cannot delete map files!"),[n,Promise.resolve()];if(!g)return[n,Promise.resolve()];const[w,x]=ie(r.current,n,g.selection,g.isSelectionInverted);x.then(()=>{v(w)})},loadMapData:async()=>{r.current=await window.showDirectoryPicker();const n=await ce(r.current);v(n)},selectRegion:(n,g)=>{c({selection:n,isSelectionInverted:g!=null?g:!1})},unselectRegion:()=>{c(void 0)},setZoomLevel:n=>{b(n)},toggleMap:n=>{u(n)}}),[]),a=m.exports.useMemo(()=>{var n;return{isMapDisplayed:s,isSelectionInverted:(n=t==null?void 0:t.isSelectionInverted)!=null?n:!1,mapData:o,selection:t==null?void 0:t.selection,zoomLevel:p}},[s,o,t,p]),d=m.exports.useMemo(()=>({actions:i,state:a}),[i,a]);return e(K.Provider,{value:d,children:l.children})};const ve=ee({palette:{mode:"dark",background:{default:"#000"}}});te.render(e(oe.StrictMode,{children:e(he,{children:e(ne,{theme:ve,children:y($,{children:[e(re,{}),e(fe,{})]})})})}),document.getElementById("root"));
